(async()=>{"use strict";function t(t){return document.querySelectorAll(t)}async function e(t,e){return await fetch(t,{method:"POST",body:"name="+e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t=>t.json())}function n(t){return t<5?0:t<12?1:t<25?2:t<50?3:t<100?4:5}function l(){let e=t("li");for(let t of e)t.remove()}let o=!1;t("form")[0].onsubmit=(async i=>{if(i.preventDefault(),o)return;l();const r=t(".holder")[0],s=t(".container")[0];o=!0,r.style.opacity=1,r.style.zIndex=10,s.style.filter="blur(2px)";const a=await e("./fetch.php",t("input")[0].value);t("p")[0].innerHTML=`<img src="assets/img/ok${n(a.length)}.png" alt="OK${n(a.length)}" style="vertical-align: middle"> Your longest streak is ${a.length} tokens`;let c="<th>ID</th><th>Token</th><th>Reason</th><th>Issuer</th><th>Date</th>";a.forEach(t=>{const e=[t.id,t.title,t.reason,t.giver_name,new Date(1e3*t.event_date).toLocaleString("en-GB")];c+=`<tr><td>${e.join("</td><td>")}</td></tr>`}),t("table")[0].innerHTML=c,o=!1,r.style.opacity=0,r.style.zIndex=-1,s.style.filter="blur(0px)"});let i=!1;t("input")[0].onkeyup=async function(n){const o=this.value;if(o.length<3||!/^[0-9a-z]+$/i.test(o)||1!==n.key.length||i)return;i=!0;let r=await e("./members.php",o);l();const s=t("ul")[0];for(let t of r){const e=this;let n=document.createElement("li");n.innerHTML+=t.name+"<br>"+t.extra,n.onclick=function(){e.value=this.innerText.split("\n")[0],e.focus(),l()},s.appendChild(n)}i=!1}})();